# vim: ft=sh
#
# http://www.linuxfromscratch.org/lfs/view/stable/chapter03/introduction.html
#

lfs_trap_err


mkdir -pv $LFS/sources
chmod -v a+wt $LFS/sources


lfs_log "downloading sources"

wget -nc http://www.linuxfromscratch.org/lfs/view/stable/wget-list  -O$LFS/sources/wget-list
wget -nc http://www.linuxfromscratch.org/lfs/view/stable/md5sums    -O$LFS/sources/md5sums

#
#   TODO: add --progress=TYPE or --show-progress to wget?
#
wget --input-file=wget-list --continue --directory-prefix=$LFS/sources -o wget-sources.log

pushd $LFS/sources

   if [[ ! -f mpc-1.0.3.tar.gz ]]; then # { 2018-02-11 mpc... apparently causes 500 Internal Server Error
     lfs_log "mpc-*.tar.gz not found, downloading from ftp.gnu.org"
     wget https://ftp.gnu.org/gnu/mpc/mpc-1.0.3.tar.gz
   fi
   
   local md5sum=$(md5sum -c md5sums)

popd

if echo $md5sums | grep -v ': OK$' > /dev/null; then
   lfs_log "md5 sums seems ok"
   return 0
else
   lfs_log "md5 sums not ok: $md5sum"
   return 1
fi
